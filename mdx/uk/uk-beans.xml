<?xml version="1.0" encoding="UTF-8"?>
<!--
    Common beans for UK federation operations.
-->
<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:util="http://www.springframework.org/schema/util"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="
        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
        http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-3.0.xsd">

    <!--
        membersResource
        
        A Resource referencing the members.xml document.
    -->
    <bean id="membersResource" class="org.opensaml.util.resource.FilesystemResource" lazy-init="true">
        <constructor-arg value="#{ systemProperties['basedir'] }/xml/members.xml"/>
    </bean>
    
    <!--
        membersDocument
        
        This bean contains the contents of the members.xml file as a DOM Document.
    -->
    <bean id="membersDocument" class="net.shibboleth.ext.spring.factory.DomDocumentFactoryBean" lazy-init="true">
        <property name="documentResource" ref="membersResource"/>
        <property name="parserPool" ref="parserPool"/>
    </bean>
    
    <!--
        members
        
        This bean implements an API for access to the contents of the members.xml document.
    -->
    <bean id="members" class="uk.org.ukfederation.members.Members" lazy-init="true">
        <constructor-arg>
            <bean class="java.io.File">
                <constructor-arg value="#{ systemProperties['basedir'] }/xml/members.xml"/>
            </bean>
        </constructor-arg>
    </bean>
    
    <!--
        ukTrustRootsDocument
        
        This bean contains the contents of the master.xml file as a DOM Document.
    -->
    <bean id="ukTrustRootsDocument" class="net.shibboleth.ext.spring.factory.DomDocumentFactoryBean"
        lazy-init="true">
        <property name="parserPool" ref="parserPool"/>
        <property name="documentResource">
            <bean class="org.opensaml.util.resource.FilesystemResource">
                <constructor-arg value="#{ systemProperties['basedir'] }/xml/master.xml"/>
            </bean>
        </property>
    </bean>    
    
    <!--
        addUKTrustRoots
        
        This stage adds the UK federation trust roots to an EntitiesDescriptor.
    -->
    <bean id="addUKTrustRoots" class="net.shibboleth.metadata.dom.XSLTransformationStage"
        init-method="initialize" lazy-init="true">
        <property name="id" value="addUKTrustRoots"/>
        <property name="xslResource">
            <bean class="org.opensaml.util.resource.FilesystemResource">
                <constructor-arg value="#{ systemProperties['basedir'] }/mdx/uk/trust_roots.xsl"/>
            </bean>
        </property>
        <property name="transformParameters">
            <map>
                <entry key="trustRootsDocument" value-ref="ukTrustRootsDocument"/>
            </map>
        </property>
    </bean>
    
</beans>
